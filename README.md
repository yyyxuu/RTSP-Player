# RTSP æ’­æ”¾å™¨

[English](README_EN.md) | ç®€ä½“ä¸­æ–‡

ä¸€ä¸ªå®Œæ•´çš„ RTSP æµåª’ä½“æ’­æ”¾è§£å†³æ–¹æ¡ˆï¼ŒåŒ…å«å‰ç«¯æ’­æ”¾å™¨å’Œåç«¯è½¬ç æœåŠ¡ã€‚æ”¯æŒå®æ—¶ RTSP æµè½¬ HLS æ ¼å¼æ’­æ”¾ï¼Œå…·å¤‡å®Œå–„çš„é”™è¯¯å¤„ç†ã€æ—¥å¿—è®°å½•å’Œæ€§èƒ½ä¼˜åŒ–ã€‚

## âœ¨ ä¸»è¦ç‰¹æ€§

- **å®æ—¶è½¬ç **: ä½¿ç”¨ FFmpeg å°† RTSP æµå®æ—¶è½¬ç ä¸º HLS æ ¼å¼
- **ç°ä»£åŒ–å‰ç«¯**: å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯ï¼Œä¼˜é›…çš„ç”¨æˆ·ç•Œé¢
- **å®Œå–„é”™è¯¯å¤„ç†**: å…¨é¢çš„é”™è¯¯æ•è·å’Œå¤„ç†æœºåˆ¶
- **ç»“æ„åŒ–æ—¥å¿—**: åˆ†çº§æ—¥å¿—è®°å½•ï¼Œæ”¯æŒæ–‡ä»¶è½®è½¬
- **é…ç½®ç®¡ç†**: çµæ´»çš„é…ç½®ç³»ç»Ÿï¼Œæ”¯æŒç¯å¢ƒå˜é‡
- **æ€§èƒ½ä¼˜åŒ–**: è¿æ¥æ•°é™åˆ¶ã€èµ„æºè‡ªåŠ¨æ¸…ç†ã€å¿ƒè·³æ£€æµ‹
- **å¥åº·ç›‘æ§**: å†…ç½®å¥åº·æ£€æŸ¥å’Œç›‘æ§æ¥å£
- **ä¼˜é›…å…³é—­**: æ”¯æŒä¼˜é›…å…³é—­ï¼Œä¸ä¸¢å¤±æ•°æ®

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
RTSPæº -> FFmpegè½¬ç  -> HLSåˆ†ç‰‡ -> æµè§ˆå™¨æ’­æ”¾
     ^           |            |           |
     |           v            v           |
  æ‘„åƒå¤´    åç«¯æœåŠ¡     WebSocket      å‰ç«¯æ’­æ”¾å™¨
```

### æ ¸å¿ƒç»„ä»¶

- **RTSPStreamer**: ä¸»æœåŠ¡ç±»ï¼Œç®¡ç†æ‰€æœ‰åŠŸèƒ½
- **Logger**: ç»“æ„åŒ–æ—¥å¿—è®°å½•å™¨
- **Config**: é…ç½®ç®¡ç†æ¨¡å—
- **WebSocket**: å®æ—¶é€šä¿¡æ¥å£
- **Express**: HTTP æœåŠ¡å’Œé™æ€æ–‡ä»¶æœåŠ¡

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- Node.js (v14.0.0 æˆ–æ›´é«˜ç‰ˆæœ¬)
- FFmpeg (ç”¨äºè½¬ç )
- å†…å­˜: å»ºè®® 2GB ä»¥ä¸Š
- ç£ç›˜: è‡³å°‘ 1GB å¯ç”¨ç©ºé—´ï¼ˆç”¨äº HLS ç¼“å­˜ï¼‰

### å®‰è£… FFmpeg

**macOS:**

```bash
brew install ffmpeg
```

**Ubuntu/Debian:**

```bash
sudo apt update
sudo apt install ffmpeg
```

**CentOS/RHEL:**

```bash
sudo yum install ffmpeg
# æˆ–è€…åœ¨è¾ƒæ–°ç‰ˆæœ¬ä¸­ä½¿ç”¨
sudo dnf install ffmpeg
```

**Windows:**
ä» [FFmpeg å®˜ç½‘](https://ffmpeg.org/download.html) ä¸‹è½½å¹¶å®‰è£…ï¼Œå¹¶ç¡®ä¿æ·»åŠ åˆ° PATH ç¯å¢ƒå˜é‡

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/yyyxuu/RTSP-Player.git
cd RTSP_Test
```

### 2. å®‰è£…ä¾èµ–

```bash
npm install
```

### 3. é…ç½®é¡¹ç›®

å¤åˆ¶é»˜è®¤é…ç½®å¹¶æ ¹æ®éœ€è¦ä¿®æ”¹ï¼š

```bash
cp config.js.example config.js
```

ä¸»è¦é…ç½®é¡¹ï¼š

```javascript
// config.js
module.exports = {
  server: {
    port: 3000, // æœåŠ¡å™¨ç«¯å£
    host: "0.0.0.0", // æœåŠ¡å™¨åœ°å€
  },
  ffmpeg: {
    size: "640x480", // è¾“å‡ºåˆ†è¾¨ç‡
    fps: 25, // å¸§ç‡
    preset: "ultrafast", // ç¼–ç é€Ÿåº¦é¢„è®¾
  },
  logging: {
    level: "info", // æ—¥å¿—çº§åˆ«
    file: "./logs/app.log", // æ—¥å¿—æ–‡ä»¶è·¯å¾„
  },
};
```

### 4. å¯åŠ¨æœåŠ¡

```bash
# ç”Ÿäº§æ¨¡å¼
npm start

# å¼€å‘æ¨¡å¼ï¼ˆè‡ªåŠ¨é‡å¯ï¼‰
npm run dev
```

### 5. è®¿é—®åº”ç”¨

æ‰“å¼€æµè§ˆå™¨è®¿é—®: `http://localhost:3000`

## ğŸ“– ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ä½¿ç”¨

1. åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥ RTSP æµåœ°å€
2. ç‚¹å‡»"è¿æ¥"æŒ‰é’®å¼€å§‹æ’­æ”¾
3. ç‚¹å‡»"åœæ­¢"æŒ‰é’®ç»“æŸæ’­æ”¾

### ç¤ºä¾‹ RTSP æµ

é¡¹ç›®æä¾›äº†ä¸€äº›æµ‹è¯•æµåœ°å€ï¼š

- `rtsp://wowzaec2demo.streamlock.net/vod/mp4:BigBuckBunny_115k.mp4`
- `rtsp://wowzaec2demo.streamlock.net/vod/mp4:BigBuckBunny_465k.mp4`

### å¿«æ·æ“ä½œ

é¡µé¢æä¾›äº†é¢„è®¾çš„ç¤ºä¾‹æµæŒ‰é’®ï¼Œç‚¹å‡»å³å¯å¿«é€Ÿå¡«å…¥åœ°å€ã€‚

## âš™ï¸ é«˜çº§é…ç½®

### ç¯å¢ƒå˜é‡

æ”¯æŒä»¥ä¸‹ç¯å¢ƒå˜é‡é…ç½®ï¼š

```bash
# æœåŠ¡å™¨é…ç½®
PORT=3000                    # æœåŠ¡å™¨ç«¯å£
HOST=0.0.0.0                 # æœåŠ¡å™¨åœ°å€
NODE_ENV=production         # è¿è¡Œç¯å¢ƒ

# æ—¥å¿—é…ç½®
LOG_LEVEL=info              # æ—¥å¿—çº§åˆ« (error|warn|info|debug)

# å®‰å…¨é…ç½®
ALLOWED_ORIGINS=*           # å…è®¸çš„è·¨åŸŸæ¥æºï¼Œé€—å·åˆ†éš”
```

### FFmpeg å‚æ•°ä¼˜åŒ–

é’ˆå¯¹ä¸åŒåœºæ™¯çš„ FFmpeg å‚æ•°å»ºè®®ï¼š

**ä½å»¶è¿Ÿåœºæ™¯:**

```javascript
ffmpeg: {
    preset: 'ultrafast',
    tune: 'zerolatency',
    g: 25,
    hls_time: 1
}
```

**é«˜è´¨é‡åœºæ™¯:**

```javascript
ffmpeg: {
    preset: 'medium',
    crf: 23,
    size: '1280x720',
    hls_time: 4
}
```

**ä½å¸¦å®½åœºæ™¯:**

```javascript
ffmpeg: {
    preset: 'fast',
    size: '426x240',
    fps: 15,
    bitrate: '300k'
}
```

## ğŸ“Š API æ¥å£

### RESTful API

#### è·å–æ‰€æœ‰æ´»åŠ¨æµ

```http
GET /api/streams
```

å“åº”ç¤ºä¾‹:

```json
{
  "success": true,
  "data": [
    {
      "id": "stream_1234567890_abc123",
      "rtspUrl": "rtsp://example.com/live/stream",
      "connections": 1,
      "startTime": 1640995200000,
      "duration": 30000,
      "status": "active"
    }
  ]
}
```

#### å¥åº·æ£€æŸ¥

```http
GET /api/health
```

å“åº”ç¤ºä¾‹:

```json
{
  "success": true,
  "data": {
    "uptime": 3600,
    "memory": {
      "rss": 134217728,
      "heapTotal": 67108864,
      "heapUsed": 45088768,
      "external": 2097152
    },
    "connections": 5,
    "streams": 2,
    "timestamp": "2023-12-31T12:00:00.000Z"
  }
}
```

### WebSocket æ¥å£

#### è¿æ¥åœ°å€

```
ws://localhost:3000
wss://your-domain.com (HTTPSç¯å¢ƒ)
```

#### æ¶ˆæ¯æ ¼å¼

**å¼€å§‹æ’­æ”¾:**

```json
{
  "type": "startStream",
  "rtspUrl": "rtsp://example.com/live/stream"
}
```

**åœæ­¢æ’­æ”¾:**

```json
{
  "type": "stopStream",
  "streamId": "stream_1234567890_abc123"
}
```

**æœåŠ¡å™¨å“åº”:**

```json
{
  "type": "streamStarted",
  "streamId": "stream_1234567890_abc123",
  "message": "RTSPæµå¼€å§‹å¤„ç†",
  "timestamp": "2023-12-31T12:00:00.000Z"
}
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
RTSP_Test/
â”œâ”€â”€ package.json              # é¡¹ç›®ä¾èµ–é…ç½®
â”œâ”€â”€ server.js                 # åŸå§‹æœåŠ¡å™¨æ–‡ä»¶
â”œâ”€â”€ server-improved.js        # ä¼˜åŒ–ç‰ˆæœåŠ¡å™¨æ–‡ä»¶
â”œâ”€â”€ config.js                 # é…ç½®ç®¡ç†æ¨¡å—
â”œâ”€â”€ logger.js                 # æ—¥å¿—è®°å½•æ¨¡å—
â”œâ”€â”€ public/                   # å‰ç«¯é™æ€æ–‡ä»¶
â”‚   â”œâ”€â”€ index.html           # ä¸»é¡µé¢
â”‚   â””â”€â”€ streams/             # HLSæ–‡ä»¶ç›®å½•ï¼ˆè¿è¡Œæ—¶åˆ›å»ºï¼‰
â”œâ”€â”€ logs/                     # æ—¥å¿—æ–‡ä»¶ç›®å½•ï¼ˆè¿è¡Œæ—¶åˆ›å»ºï¼‰
â”œâ”€â”€ user.config.js           # ç”¨æˆ·è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
â””â”€â”€ README.md                 # é¡¹ç›®æ–‡æ¡£
```

## ğŸ”§ å¼€å‘æŒ‡å—

### å¼€å‘ç¯å¢ƒè®¾ç½®

```bash
# å®‰è£…ä¾èµ–
npm install

# å¼€å‘æ¨¡å¼è¿è¡Œ
npm run dev

# ç”Ÿäº§æ¨¡å¼è¿è¡Œ
npm start
```

### ä»£ç è§„èŒƒ

- ä½¿ç”¨ ES6+è¯­æ³•
- éµå¾ªé©¼å³°å‘½åè§„åˆ™
- å‡½æ•°å’Œæ–¹æ³•åº”æœ‰æ³¨é‡Šè¯´æ˜
- é”™è¯¯å¤„ç†å¿…é¡»å®Œæ•´
- æ—¥å¿—è®°å½•å¿…é¡»åŒ…å«ä¸Šä¸‹æ–‡ä¿¡æ¯

### æ‰©å±•åŠŸèƒ½

#### æ·»åŠ æ–°çš„æ¶ˆæ¯ç±»å‹

1. åœ¨ WebSocket æ¶ˆæ¯å¤„ç†ä¸­æ·»åŠ æ–°çš„ case
2. å®ç°ç›¸åº”çš„å¤„ç†æ–¹æ³•
3. æ›´æ–°å‰ç«¯æ¶ˆæ¯å¤„ç†é€»è¾‘

#### è‡ªå®šä¹‰ FFmpeg å‚æ•°

åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹ FFmpeg é€‰é¡¹ï¼š

```javascript
ffmpeg: {
  // æ·»åŠ è‡ªå®šä¹‰å‚æ•°
  customOptions: ["-vf", "scale=1920:1080", "-b:v", "2000k"];
}
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**1. FFmpeg æœªæ‰¾åˆ°**

```
é”™è¯¯: Cannot find ffmpeg
è§£å†³: ç¡®ä¿FFmpegå·²å®‰è£…å¹¶æ·»åŠ åˆ°PATHç¯å¢ƒå˜é‡
```

**2. RTSP è¿æ¥å¤±è´¥**

```
é”™è¯¯: Connection timeout
è§£å†³: æ£€æŸ¥RTSPåœ°å€æ˜¯å¦æ­£ç¡®ï¼Œç½‘ç»œæ˜¯å¦é€šç•…
```

**3. æ’­æ”¾å¡é¡¿**

```
é—®é¢˜: è§†é¢‘æ’­æ”¾ä¸æµç•…
è§£å†³: è°ƒæ•´FFmpegå‚æ•°ï¼Œé™ä½åˆ†è¾¨ç‡æˆ–ç ç‡
```

**4. å†…å­˜ä½¿ç”¨è¿‡é«˜**

```
é—®é¢˜: æœåŠ¡å™¨å†…å­˜å ç”¨æŒç»­å¢é•¿
è§£å†³: æ£€æŸ¥æ–‡ä»¶æ¸…ç†é…ç½®ï¼Œé‡å¯æœåŠ¡å™¨
```

### æ—¥å¿—åˆ†æ

æ—¥å¿—æ–‡ä»¶ä½ç½®: `./logs/app.log`

å¸¸è§é”™è¯¯å…³é”®è¯:

- `FFmpegé”™è¯¯`: è½¬ç ç›¸å…³é—®é¢˜
- `WebSocketé”™è¯¯`: è¿æ¥é—®é¢˜
- `æ–‡ä»¶æ¸…ç†å¤±è´¥`: ç£ç›˜æƒé™é—®é¢˜

### æ€§èƒ½ç›‘æ§

ä½¿ç”¨å¥åº·æ£€æŸ¥æ¥å£ç›‘æ§æœåŠ¡å™¨çŠ¶æ€ï¼š

```bash
curl http://localhost:3000/api/health
```

å…³é”®æŒ‡æ ‡:

- `uptime`: æœåŠ¡å™¨è¿è¡Œæ—¶é—´
- `connections`: å½“å‰è¿æ¥æ•°
- `streams`: æ´»åŠ¨æµæ•°é‡
- `memory`: å†…å­˜ä½¿ç”¨æƒ…å†µ

## ğŸ›¡ï¸ å®‰å…¨å»ºè®®

1. **ç”Ÿäº§ç¯å¢ƒé…ç½®:**

   - è®¾ç½®é€‚å½“çš„ CORS ç­–ç•¥
   - ä½¿ç”¨ HTTPS åè®®
   - é…ç½®é˜²ç«å¢™è§„åˆ™

2. **è®¿é—®æ§åˆ¶:**

   - é™åˆ¶å…è®¸çš„ RTSP æºåœ°å€
   - è®¾ç½®è¿æ¥æ•°é™åˆ¶
   - å®æ–½é€Ÿç‡é™åˆ¶

3. **æ•°æ®ä¿æŠ¤:**
   - å®šæœŸæ¸…ç† HLS ç¼“å­˜æ–‡ä»¶
   - é…ç½®æ—¥å¿—è½®è½¬
   - ç›‘æ§ç£ç›˜ç©ºé—´ä½¿ç”¨

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### æœåŠ¡å™¨é…ç½®

```javascript
// config.js
module.exports = {
  websocket: {
    maxConnections: 100, // æœ€å¤§è¿æ¥æ•°
    heartbeatInterval: 30000, // å¿ƒè·³é—´éš”
  },
  streams: {
    cleanupInterval: 60000, // æ¸…ç†é—´éš”
    maxAge: 300000, // æ–‡ä»¶æœ€å¤§ä¿å­˜æ—¶é—´
  },
};
```

### FFmpeg è°ƒä¼˜

é’ˆå¯¹ä¸åŒç¡¬ä»¶é…ç½®çš„ä¼˜åŒ–å»ºè®®ï¼š

**ä½é…ç½®æœåŠ¡å™¨:**

```javascript
ffmpeg: {
    preset: 'ultrafast',
    size: '426x240',
    fps: 15,
    bitrate: '300k'
}
```

**é«˜é…ç½®æœåŠ¡å™¨:**

```javascript
ffmpeg: {
    preset: 'medium',
    size: '1920x1080',
    fps: 30,
    bitrate: '5000k'
}
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

### ä»£ç æäº¤è§„èŒƒ

- `feat`: æ–°åŠŸèƒ½
- `fix`: ä¿®å¤ bug
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼è°ƒæ•´
- `refactor`: ä»£ç é‡æ„
- `test`: æµ‹è¯•ç›¸å…³
- `chore`: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ™ è‡´è°¢

- [Video.js](https://videojs.com/) - HTML5 è§†é¢‘æ’­æ”¾å™¨
- [fluent-ffmpeg](https://github.com/fluent-ffmpeg/node-fluent-ffmpeg) - FFmpeg Node.js å°è£…
- [WebSocket](https://github.com/websockets/ws) - WebSocket å®ç°
- [FFmpeg](https://ffmpeg.org/) - å¤šåª’ä½“å¤„ç†å·¥å…·

## ğŸ“ æ”¯æŒ

å¦‚æœæ‚¨é‡åˆ°é—®é¢˜æˆ–æœ‰åŠŸèƒ½å»ºè®®ï¼Œè¯·ï¼š

1. æŸ¥çœ‹ [FAQ](#-æ•…éšœæ’é™¤) éƒ¨åˆ†
2. æœç´¢ç°æœ‰çš„ [Issues](../../issues)
3. åˆ›å»ºæ–°çš„ Issue å¹¶æä¾›è¯¦ç»†ä¿¡æ¯

---

**æ³¨æ„:** æœ¬é¡¹ç›®ä»…ç”¨äºå­¦ä¹ å’Œå¼€å‘ç›®çš„ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å‰è¯·ç¡®ä¿å……åˆ†æµ‹è¯•ã€‚
